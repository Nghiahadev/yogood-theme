{% comment %}
  Section: Popular products tabs
{% endcomment %}

{%- assign uid = 'popular-tabs-' | append: section.id -%}

<section class="{{ uid }}">
  <div class="{{ uid }}__wrap page-width">

    <p class="{{ uid }}__kicker">{{ section.settings.kicker }}</p>
    <h2 class="{{ uid }}__heading">{{ section.settings.heading }}</h2>
    <div class="{{ uid }}__subtext">{{ section.settings.subtext }}</div>

    <!-- Tabs -->
    <div class="{{ uid }}__tabs">
      <button class="{{ uid }}__tab is-active" data-tab="1">{{ section.settings.tab1_label }}</button>
      <button class="{{ uid }}__tab" data-tab="2">{{ section.settings.tab2_label }}</button>
      <button class="{{ uid }}__tab" data-tab="3">{{ section.settings.tab3_label }}</button>
    </div>

    <!-- Panels -->
    <div class="{{ uid }}__panels">

      {% for i in (1..3) %}
        {% assign collection_setting = 'tab' | append: i | append: '_collection' %}
        {% assign collection_handle = section.settings[collection_setting] %}
        {% assign collection_obj = collections[collection_handle] %}

        <div class="{{ uid }}__panel {% if i == 1 %}is-active{% endif %}" data-panel="{{ i }}">
          <div class="{{ uid }}__grid">

            {% if collection_obj != blank %}
              {% for product in collection_obj.products limit: section.settings.product_limit %}
                <div class="{{ uid }}__card">
                  <a href="{{ product.url }}" class="{{ uid }}__imgWrap">
                    {% if product.featured_image %}
                      <img
                        src="{{ product.featured_image | image_url: width: 600 }}"
                        alt="{{ product.title | escape }}"
                        loading="lazy"
                      >
                    {% endif %}
                  </a>

                  <div class="{{ uid }}__cardBottom">
                    <div>
                      <a href="{{ product.url }}" class="{{ uid }}__title">
                        {{ product.title }}
                      </a>
                      <div class="{{ uid }}__price">
                        {{ product.price | money }}
                      </div>
                    </div>

                    {% assign v = product.selected_or_first_available_variant %}
                    <form method="post" action="/cart/add">
                      <input type="hidden" name="id" value="{{ v.id }}">
                      <button type="submit" class="{{ uid }}__cartBtn" aria-label="Add to cart">
                        üõç
                      </button>
                    </form>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p class="{{ uid }}__empty">Select a collection in section settings.</p>
            {% endif %}

          </div>
        </div>
      {% endfor %}

    </div>
  </div>
</section>

<style>
  .{{ uid }} { padding: 40px 0; text-align: center; }
  .{{ uid }}__kicker { margin: 0 0 6px; color: #d7a64a; font-weight: 700; }
  .{{ uid }}__heading { margin: 0 0 14px; font-size: 48px; font-weight: 800; color: #0b1b55; }
  .{{ uid }}__subtext {  margin: 0 auto 24px; max-width: 720px; }

  .{{ uid }}__tabs {
    display: flex;
    gap: 40px;
    justify-content: center;
    margin-bottom: 40px;
  }

  .{{ uid }}__tab {
    background: none;
    border: 2px solid transparent;
    padding: 10px 22px;
    border-radius: 999px;
    font-weight: 800;
    cursor: pointer;
  }

  .{{ uid }}__tab.is-active {
    border-color: #d7a64a;
    color: #d7a64a;
  }

  .{{ uid }}__panel { display: none; }
  .{{ uid }}__panel.is-active { display: block; }

  .{{ uid }}__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 26px;
  }

  .{{ uid }}__card {
    border: 2px solid #f0e6d2;
    border-radius: 22px;
    padding: 20px;
    text-align: left;
  }

  .{{ uid }}__imgWrap {
    display: block;
    aspect-ratio: 4 / 3;
    background: #fff;
    border-radius: 18px;
    overflow: hidden;
  }

  .{{ uid }}__imgWrap img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .{{ uid }}__cardBottom {
    margin-top: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .{{ uid }}__title {
    font-weight: 800;
    color: #0b1b55;
    text-decoration: none;
  }

  .{{ uid }}__price {
    color: #d7a64a;
    font-weight: 800;
  }

  .{{ uid }}__cartBtn {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    border: none;
    background: #d7a64a;
    cursor: pointer;
  }

  @media (max-width: 900px) {
    .{{ uid }}__grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>

<script>
  (function(){
    const root = document.querySelector(".{{ uid }}");
    if (!root) return;

    const tabs = root.querySelectorAll(".{{ uid }}__tab");
    const panels = root.querySelectorAll(".{{ uid }}__panel");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const id = tab.dataset.tab;

        tabs.forEach(t => t.classList.remove("is-active"));
        panels.forEach(p => p.classList.remove("is-active"));

        tab.classList.add("is-active");
        root.querySelector('[data-panel="'+id+'"]').classList.add("is-active");
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Popular products",
  "settings": [
    { "type": "text", "id": "kicker", "label": "Small heading", "default": "About company" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Popular Milk Products" },
    { "type": "richtext", "id": "subtext", "label": "Description" },

    { "type": "text", "id": "tab1_label", "label": "Tab 1 label", "default": "Ice Cream" },
    { "type": "collection", "id": "tab1_collection", "label": "Tab 1 collection" },

    { "type": "text", "id": "tab2_label", "label": "Tab 2 label", "default": "Yogurts" },
    { "type": "collection", "id": "tab2_collection", "label": "Tab 2 collection" },

    { "type": "text", "id": "tab3_label", "label": "Tab 3 label", "default": "Milk" },
    { "type": "collection", "id": "tab3_collection", "label": "Tab 3 collection" },

    { "type": "range", "id": "product_limit", "label": "Products per tab", "min": 2, "max": 8, "step": 1, "default": 4 }
  ],
  "presets": [
    { "name": "Popular products" }
  ]
}
{% endschema %}
